<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å—ã‘å…¥ã‚Œå…ƒå…¥åŠ›ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f9f9f9;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        .hint {
            margin-top: 5px;
            font-size: 14px;
            color: #666;
        }
        .sources {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .sources h3 {
            margin-top: 0;
            color: #333;
        }
        .sources ul {
            margin: 0;
            padding-left: 20px;
        }
        .sources li {
            margin: 5px 0;
        }
        .loading {
            color: #007bff;
            font-style: italic;
        }
    </style>
</head>
<body>
    <h1>ğŸ“š å—ã‘å…¥ã‚Œå…ƒå…¥åŠ›æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="form-group">
        <label for="acceptance_source">
            å—ã‘å…¥ã‚Œå…ƒ 
            <span style="font-weight: normal; color: #666;">ï¼ˆé¸æŠã¾ãŸã¯è‡ªç”±å…¥åŠ›ï¼‰</span>
        </label>
        <input
            id="acceptance_source"
            list="acceptance_source_options"
            type="text"
            placeholder="é¸æŠã¾ãŸã¯å…¥åŠ›ã—ã¦ãã ã•ã„"
            oninput="updateValue(this.value)"
        />
        <datalist id="acceptance_source_options">
            <!-- å‹•çš„ã«èª­ã¿è¾¼ã¾ã‚Œã‚‹å€™è£œãŒã“ã“ã«å…¥ã‚‹ -->
        </datalist>
        <div class="hint">
            ğŸ’¡ å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å€™è£œã‹ã‚‰é¸æŠã™ã‚‹ã‹ã€ç›´æ¥å…¥åŠ›ã—ã¦ãã ã•ã„
        </div>
    </div>

    <div>
        <strong>å…¥åŠ›å€¤:</strong> <span id="current-value">ï¼ˆæœªå…¥åŠ›ï¼‰</span>
    </div>

    <div class="sources">
        <h3>ğŸ“‹ åˆ©ç”¨å¯èƒ½ãªå€™è£œ</h3>
        <div id="loading-message" class="loading">å€™è£œã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
        <ul id="sources-list" style="display: none;"></ul>
    </div>

    <script>
        // ç¾åœ¨ã®å€¤ã‚’è¡¨ç¤º
        function updateValue(value) {
            document.getElementById('current-value').textContent = value || 'ï¼ˆæœªå…¥åŠ›ï¼‰';
        }

        // å—ã‘å…¥ã‚Œå…ƒå€™è£œã‚’èª­ã¿è¾¼ã¿
        async function loadAcceptanceSources() {
            try {
                const response = await fetch('/api/books/acceptance-sources', {
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                
                if (data.sources && Array.isArray(data.sources)) {
                    updateDatalist(data.sources);
                    updateSourcesList(data.sources);
                    document.getElementById('loading-message').style.display = 'none';
                    document.getElementById('sources-list').style.display = 'block';
                } else {
                    throw new Error('Invalid data format');
                }

            } catch (error) {
                console.error('å€™è£œã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('loading-message').textContent = 
                    'ã‚¨ãƒ©ãƒ¼: ' + error.message;
            }
        }

        // datalistã‚’æ›´æ–°
        function updateDatalist(sources) {
            const datalist = document.getElementById('acceptance_source_options');
            datalist.innerHTML = '';
            
            sources.forEach(source => {
                const option = document.createElement('option');
                option.value = source;
                datalist.appendChild(option);
            });
        }

        // å€™è£œãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
        function updateSourcesList(sources) {
            const list = document.getElementById('sources-list');
            list.innerHTML = '';
            
            sources.forEach(source => {
                const li = document.createElement('li');
                li.textContent = source;
                li.style.cursor = 'pointer';
                li.onclick = () => {
                    document.getElementById('acceptance_source').value = source;
                    updateValue(source);
                };
                list.appendChild(li);
            });
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ
        document.addEventListener('DOMContentLoaded', () => {
            loadAcceptanceSources();
        });
    </script>
</body>
</html>
